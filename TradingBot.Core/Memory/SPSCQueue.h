#pragma once
#include <boost/lockfree/spsc_queue.hpp>
#include <cstddef>

namespace TradingBot::Core::Memory {

    // ???????????????????????????????????????????????????????????????
    // SPSCQueue<T>: Lock-free Single Producer Single Consumer Queue
    // ???????????????????????????????????????????????????????????????
    // Использует boost::lockfree::spsc_queue
    // 
    // Характеристики:
    // - Ring buffer с атомарными указателями
    // - Cache line padding (64 bytes) для избежания false sharing
    // - Capacity — степень двойки (для оптимизации модуля)
    // - Без mutex/lock в hot path
    // 
    // Архитектура:
    // Producer Thread ? [Ring Buffer] ? Consumer Thread
    // (Network)         (lock-free)      (Main Thread)
    // ???????????????????????????????????????????????????????????????

    template<typename T, size_t Capacity = 1024>
    using SPSCQueue = boost::lockfree::spsc_queue<T, boost::lockfree::capacity<Capacity>>;

    // ???????????????????????????????????????????????????????????????
    // Примеры использования:
    // ???????????????????????????????????????????????????????????????

    // 1. Network thread ? Main thread (OrderBookUpdate)
    // SPSCQueue<OrderBookUpdate*, 1024> updateQueue_;
    //
    // Producer (network thread):
    //   updateQueue_.push(update);
    //
    // Consumer (main thread):
    //   OrderBookUpdate* update;
    //   while (updateQueue_.pop(update)) {
    //       ProcessUpdate(update);
    //   }

    // 2. Strategy thread ? OMS thread (OrderRequest)
    // SPSCQueue<OrderRequest*, 512> orderQueue_;
    //
    // Producer (strategy thread):
    //   orderQueue_.push(request);
    //
    // Consumer (OMS thread):
    //   OrderRequest* request;
    //   while (orderQueue_.pop(request)) {
    //       SubmitOrder(request);
    //   }

    // ???????????????????????????????????????????????????????????????
    // Рекомендации по sizing:
    // ???????????????????????????????????????????????????????????????
    // - OrderBookUpdate: 1024 (частые updates)
    // - Trade: 512 (средняя частота)
    // - OrderRequest: 256 (редкие)
    // - ExecutionReport: 256 (редкие)
    //
    // Capacity должна быть БОЛЬШЕ максимального burst размера
    // для избежания блокировок producer'а

} // namespace TradingBot::Core::Memory
