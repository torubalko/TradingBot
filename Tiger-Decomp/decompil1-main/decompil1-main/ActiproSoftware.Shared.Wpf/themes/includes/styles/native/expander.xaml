<?xml version="1.0" encoding="utf-8"?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:controls="clr-namespace:ActiproSoftware.Windows.Controls" xmlns:controlsPrimitives="clr-namespace:ActiproSoftware.Windows.Controls.Primitives" xmlns:data="clr-namespace:ActiproSoftware.Windows.Data" xmlns:themes="clr-namespace:ActiproSoftware.Windows.Themes">
  <data:ConditionalConverter x:Key="CheckedConditionalConverter" TrueValue="-1" FalseValue="1" />
  <data:ConditionalConverter x:Key="ConditionalConverter" />
  <data:CornerRadiusConverter x:Key="CornerRadiusConverter" />
  <data:ThicknessConverter x:Key="ThicknessConverter" />
  <Style x:Key="ExpanderHeaderFocusVisual">
    <Setter Property="Control.Template">
      <Setter.Value>
        <ControlTemplate>
          <Border>
            <Rectangle Margin="1" StrokeThickness="1" Stroke="{DynamicResource {x:Static themes:AssetResourceKeys.ContainerForegroundLowDisabledBrushKey}}" StrokeDashArray="1 2" SnapsToDevicePixels="True" />
          </Border>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
  <Style x:Key="ExpanderHeaderStyle" TargetType="{x:Type ToggleButton}">
    <Setter Property="Background" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderBackgroundNormalBrushKey}}" />
    <Setter Property="BorderBrush" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderBorderNormalBrushKey}}" />
    <Setter Property="BorderThickness" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderBorderNormalThicknessKey}}" />
    <Setter Property="Foreground" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderForegroundNormalBrushKey}}" />
    <Setter Property="FrameworkElement.FocusVisualStyle" Value="{StaticResource ExpanderHeaderFocusVisual}" />
    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
    <Setter Property="VerticalContentAlignment" Value="Stretch" />
    <Setter Property="UIElement.SnapsToDevicePixels" Value="True" />
    <Setter Property="themes:ThemeProperties.InnerBorderThickness" Value="1" />
    <Setter Property="themes:ThemeProperties.UseBackgroundStates" Value="True" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type ToggleButton}">
          <controlsPrimitives:ElementChrome x:Name="chrome" Background="{TemplateBinding Control.Background}" BackgroundHover="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderBackgroundHoverBrushKey}}" BorderBrush="{TemplateBinding Control.BorderBrush}" BorderBrushHover="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderBorderHoverBrushKey}}" BorderThickness="{TemplateBinding Control.BorderThickness}" InnerBorderBrush="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderInnerBorderNormalBrushKey}}" InnerBorderBrushHover="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderInnerBorderHoverBrushKey}}" InnerBorderThickness="{TemplateBinding themes:ThemeProperties.InnerBorderThickness}" CornerRadius="{TemplateBinding themes:ThemeProperties.CornerRadius}" SnapsToDevicePixels="True">
            <Grid Background="#00FFFFFF">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              <controls:PixelSnapper VerticalRoundMode="CeilingToOdd" Margin="{Binding Path=Padding, ConverterParameter=Left,Top,Bottom, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource ThicknessConverter}}">
                <ContentPresenter HorizontalAlignment="{TemplateBinding Control.HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding Control.VerticalContentAlignment}" SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" RecognizesAccessKey="True" />
              </controls:PixelSnapper>
              <controls:PixelSnapper Grid.Column="1" Margin="{TemplateBinding Control.Padding}" MinWidth="{DynamicResource {x:Static SystemParameters.HorizontalScrollBarButtonWidthKey}}" VerticalRoundMode="CeilingToOdd">
                <ContentPresenter Name="glyphPresenter" ContentTemplate="{TemplateBinding themes:HeaderedControlThemeProperties.HeaderGlyphTemplate}" HorizontalAlignment="Center" VerticalAlignment="Center" RenderTransformOrigin="0.5,0.5">
                  <UIElement.RenderTransform>
                    <ScaleTransform ScaleY="{Binding Path=IsChecked, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource CheckedConditionalConverter}}" />
                  </UIElement.RenderTransform>
                </ContentPresenter>
              </controls:PixelSnapper>
            </Grid>
          </controlsPrimitives:ElementChrome>
          <ControlTemplate.Triggers>
            <MultiTrigger>
              <MultiTrigger.Conditions>
                <Condition Property="themes:ThemeProperties.UseBackgroundStates" Value="True" />
                <Condition Property="UIElement.IsMouseOver" Value="True" />
              </MultiTrigger.Conditions>
              <Setter TargetName="chrome" Property="controlsPrimitives:ElementChrome.State" Value="Hover" />
            </MultiTrigger>
            <MultiTrigger>
              <MultiTrigger.Conditions>
                <Condition Property="themes:ThemeProperties.UseBackgroundStates" Value="True" />
                <Condition Property="IsPressed" Value="True" />
              </MultiTrigger.Conditions>
              <Setter TargetName="chrome" Property="controlsPrimitives:ElementChrome.State" Value="Hover" />
            </MultiTrigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
  <Style x:Key="{x:Static themes:SharedResourceKeys.ExpanderStyleKey}" TargetType="{x:Type Expander}">
    <Setter Property="Background" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderBackgroundNormalBrushKey}}" />
    <Setter Property="BorderBrush" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ContainerBorderLowBrushKey}}" />
    <Setter Property="BorderThickness" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderBorderNormalThicknessKey}}" />
    <Setter Property="Foreground" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ContainerForegroundLowNormalBrushKey}}" />
    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
    <Setter Property="VerticalContentAlignment" Value="Stretch" />
    <Setter Property="themes:ThemeProperties.CornerRadius" Value="{Binding Path=(themes:HeaderedControlThemeProperties.HeaderCornerRadius), ConverterParameter=Top, RelativeSource={RelativeSource Self}, Converter={StaticResource CornerRadiusConverter}}" />
    <Setter Property="themes:ThemeProperties.UseBackgroundStates" Value="True" />
    <Setter Property="themes:HeaderedControlThemeProperties.HeaderBackground" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderBackgroundNormalBrushKey}}" />
    <Setter Property="themes:HeaderedControlThemeProperties.HeaderBorderBrush" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderBorderNormalBrushKey}}" />
    <Setter Property="themes:HeaderedControlThemeProperties.HeaderBorderThickness" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderBorderNormalThicknessKey}}" />
    <Setter Property="themes:HeaderedControlThemeProperties.HeaderCornerRadius" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderBorderNormalCornerRadiusKey}}" />
    <Setter Property="themes:HeaderedControlThemeProperties.HeaderFontSize" Value="{Binding Path=FontSize, RelativeSource={RelativeSource Self}}" />
    <Setter Property="themes:HeaderedControlThemeProperties.HeaderForeground" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderForegroundNormalBrushKey}}" />
    <Setter Property="themes:HeaderedControlThemeProperties.HeaderGlyphTemplate" Value="{DynamicResource {x:Static themes:SharedResourceKeys.LargeDownArrowGlyphTemplateKey}}" />
    <Setter Property="themes:HeaderedControlThemeProperties.HeaderPadding" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ExpanderHeaderPaddingNormalThicknessKey}}" />
    <Setter Property="themes:HeaderedControlThemeProperties.HeaderStyle" Value="{StaticResource ExpanderHeaderStyle}" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type Expander}">
          <Border BorderBrush="{TemplateBinding Control.BorderBrush}" BorderThickness="{TemplateBinding Control.BorderThickness}" Background="{TemplateBinding Control.Background}" CornerRadius="{TemplateBinding themes:ThemeProperties.CornerRadius}" SnapsToDevicePixels="True">
            <DockPanel>
              <ToggleButton Name="header" DockPanel.Dock="Top" Style="{TemplateBinding themes:HeaderedControlThemeProperties.HeaderStyle}" Background="{TemplateBinding themes:HeaderedControlThemeProperties.HeaderBackground}" BorderBrush="{TemplateBinding themes:HeaderedControlThemeProperties.HeaderBorderBrush}" BorderThickness="{TemplateBinding themes:HeaderedControlThemeProperties.HeaderBorderThickness}" ContextMenu="{TemplateBinding themes:HeaderedControlThemeProperties.HeaderContextMenu}" themes:ThemeProperties.CornerRadius="{TemplateBinding themes:HeaderedControlThemeProperties.HeaderCornerRadius}" FontSize="{TemplateBinding themes:HeaderedControlThemeProperties.HeaderFontSize}" Foreground="{TemplateBinding themes:HeaderedControlThemeProperties.HeaderForeground}" themes:HeaderedControlThemeProperties.HeaderGlyphTemplate="{TemplateBinding themes:HeaderedControlThemeProperties.HeaderGlyphTemplate}" Padding="{TemplateBinding themes:HeaderedControlThemeProperties.HeaderPadding}" Content="{TemplateBinding HeaderedContentControl.Header}" ContentTemplate="{TemplateBinding HeaderedContentControl.HeaderTemplate}" ContentTemplateSelector="{TemplateBinding HeaderedContentControl.HeaderTemplateSelector}" themes:ThemeProperties.InnerBorderThickness="{TemplateBinding themes:ThemeProperties.InnerBorderThickness}" themes:ThemeProperties.UseBackgroundStates="{TemplateBinding themes:ThemeProperties.UseBackgroundStates}" IsChecked="{Binding Path=IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" />
              <controls:AnimatedExpanderDecorator x:Name="content" DockPanel.Dock="Bottom" ExpandDirection="{TemplateBinding Expander.ExpandDirection}" CollapseDuration="{Binding Path=(themes:ExpanderThemeProperties.CollapseDuration), RelativeSource={RelativeSource TemplatedParent}}" ExpandDuration="{Binding Path=(themes:ExpanderThemeProperties.ExpandDuration), RelativeSource={RelativeSource TemplatedParent}}">
                <controls:AnimatedExpanderDecorator.CollapsedVisibility>
                  <MultiBinding Converter="{StaticResource ConditionalConverter}">
                    <Binding Path="(themes:ExpanderThemeProperties.CanMeasureCollapsedContent)" RelativeSource="{RelativeSource TemplatedParent}" />
                    <Binding Source="{x:Static Visibility.Hidden}" />
                    <Binding Source="{x:Static Visibility.Collapsed}" />
                  </MultiBinding>
                </controls:AnimatedExpanderDecorator.CollapsedVisibility>
                <ContentPresenter Margin="{TemplateBinding Control.Padding}" Focusable="False" HorizontalAlignment="{TemplateBinding Control.HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding Control.VerticalContentAlignment}" />
              </controls:AnimatedExpanderDecorator>
            </DockPanel>
          </Border>
          <ControlTemplate.Triggers>
            <Trigger Property="Expander.IsExpanded" Value="True">
              <Setter TargetName="content" Property="controls:AnimatedExpanderDecorator.IsExpanded" Value="True" />
            </Trigger>
            <Trigger Property="Expander.ExpandDirection" Value="Left">
              <Setter Value="{DynamicResource {x:Static themes:SharedResourceKeys.LargeUpArrowGlyphTemplateKey}}" Property="themes:HeaderedControlThemeProperties.HeaderGlyphTemplate" />
              <Setter Property="themes:ThemeProperties.CornerRadius" Value="{Binding Path=(themes:HeaderedControlThemeProperties.HeaderCornerRadius), ConverterParameter=Right, RelativeSource={RelativeSource Self}, Converter={StaticResource CornerRadiusConverter}}" />
              <Setter TargetName="content" Property="DockPanel.Dock" Value="Left" />
              <Setter TargetName="header" Property="DockPanel.Dock" Value="Right" />
              <Setter TargetName="header" Property="FrameworkElement.LayoutTransform">
                <Setter.Value>
                  <RotateTransform Angle="-90" />
                </Setter.Value>
              </Setter>
            </Trigger>
            <Trigger Property="Expander.ExpandDirection" Value="Up">
              <Setter Value="{DynamicResource {x:Static themes:SharedResourceKeys.LargeUpArrowGlyphTemplateKey}}" Property="themes:HeaderedControlThemeProperties.HeaderGlyphTemplate" />
              <Setter Property="themes:ThemeProperties.CornerRadius" Value="{Binding Path=(themes:HeaderedControlThemeProperties.HeaderCornerRadius), ConverterParameter=Bottom, RelativeSource={RelativeSource Self}, Converter={StaticResource CornerRadiusConverter}}" />
              <Setter TargetName="content" Property="DockPanel.Dock" Value="Top" />
              <Setter TargetName="header" Property="DockPanel.Dock" Value="Bottom" />
            </Trigger>
            <Trigger Property="Expander.ExpandDirection" Value="Right">
              <Setter Property="themes:ThemeProperties.CornerRadius" Value="{Binding Path=(themes:HeaderedControlThemeProperties.HeaderCornerRadius), ConverterParameter=Left, RelativeSource={RelativeSource Self}, Converter={StaticResource CornerRadiusConverter}}" />
              <Setter TargetName="content" Property="DockPanel.Dock" Value="Right" />
              <Setter TargetName="header" Property="DockPanel.Dock" Value="Left" />
              <Setter TargetName="header" Property="FrameworkElement.LayoutTransform">
                <Setter.Value>
                  <RotateTransform Angle="-90" />
                </Setter.Value>
              </Setter>
            </Trigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
</ResourceDictionary>