<?xml version="1.0" encoding="utf-8"?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:controlsPrimitives="clr-namespace:ActiproSoftware.Windows.Controls.Primitives" xmlns:themes="clr-namespace:ActiproSoftware.Windows.Themes">
  <BorderGapMaskConverter x:Key="BorderGapMaskConverter" />
  <Style x:Key="{x:Static themes:SharedResourceKeys.GroupBoxStyleKey}" TargetType="{x:Type GroupBox}">
    <Setter Property="BorderBrush" Value="{DynamicResource {x:Static themes:AssetResourceKeys.GroupBoxBorderNormalBrushKey}}" />
    <Setter Property="BorderThickness" Value="{DynamicResource {x:Static themes:AssetResourceKeys.GroupBoxBorderNormalThicknessKey}}" />
    <Setter Property="Margin" Value="1" />
    <Setter Property="Padding" Value="1" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type GroupBox}">
          <Grid SnapsToDevicePixels="true">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="6" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="6" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Name="topGridRow" Height="Auto" />
              <RowDefinition Height="*" />
              <RowDefinition Height="6" />
            </Grid.RowDefinitions>
            <Border CornerRadius="4" Grid.Row="1" Grid.RowSpan="3" Grid.Column="0" Grid.ColumnSpan="4" IsHitTestVisible="False" BorderThickness="{TemplateBinding Control.BorderThickness}" BorderBrush="#00FFFFFF" Background="{TemplateBinding Control.Background}" />
            <Border Name="Header" Padding="3,1,3,0" Grid.Row="0" Grid.RowSpan="2" Grid.Column="1">
              <ContentPresenter ContentSource="Header" RecognizesAccessKey="True" SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" TextElement.Foreground="{DynamicResource {x:Static themes:AssetResourceKeys.GroupBoxForegroundNormalBrushKey}}" />
            </Border>
            <ContentPresenter Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2" Margin="{TemplateBinding Control.Padding}" SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" />
            <Border Name="outerBorder" CornerRadius="4" Grid.Row="1" Grid.RowSpan="3" Grid.ColumnSpan="4" BorderBrush="{DynamicResource {x:Static themes:AssetResourceKeys.GroupBoxHighlightNormalBrushKey}}" BorderThickness="0" IsHitTestVisible="False">
              <UIElement.OpacityMask>
                <MultiBinding ConverterParameter="7" Converter="{StaticResource BorderGapMaskConverter}">
                  <Binding ElementName="Header" Path="ActualWidth" />
                  <Binding Path="ActualWidth" RelativeSource="{RelativeSource Self}" />
                  <Binding Path="ActualHeight" RelativeSource="{RelativeSource Self}" />
                </MultiBinding>
              </UIElement.OpacityMask>
              <controlsPrimitives:ElementChrome x:Name="chrome" CornerRadius="3" Grid.Row="1" Grid.RowSpan="3" Grid.ColumnSpan="4" BorderBrush="{TemplateBinding Control.BorderBrush}" BorderThickness="{TemplateBinding Control.BorderThickness}" InnerBorderBrush="{DynamicResource {x:Static themes:AssetResourceKeys.GroupBoxHighlightNormalBrushKey}}" InnerBorderThickness="{TemplateBinding Control.BorderThickness}" />
            </Border>
          </Grid>
          <ControlTemplate.Triggers>
            <Trigger SourceName="chrome" Property="controlsPrimitives:ElementChrome.BorderStyle" Value="Default">
              <Setter TargetName="outerBorder" Property="Border.BorderThickness" Value="{Binding Path=BorderThickness, RelativeSource={RelativeSource TemplatedParent}}" />
            </Trigger>
            <Trigger Property="Header" Value="{x:Null}">
              <Setter TargetName="Header" Property="Visibility" Value="Collapsed" />
              <Setter TargetName="topGridRow" Property="RowDefinition.Height" Value="6" />
            </Trigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
</ResourceDictionary>