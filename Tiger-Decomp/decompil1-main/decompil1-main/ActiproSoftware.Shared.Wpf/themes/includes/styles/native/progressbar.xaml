<?xml version="1.0" encoding="utf-8"?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:PresentationOptions="http://schemas.microsoft.com/winfx/2006/xaml/presentation/options" xmlns:controls="clr-namespace:ActiproSoftware.Windows.Controls" xmlns:controlsPrimitives="clr-namespace:ActiproSoftware.Windows.Controls.Primitives" xmlns:themes="clr-namespace:ActiproSoftware.Windows.Themes">
  <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
  <LinearGradientBrush x:Key="ProgressBarTopHighlight" PresentationOptions:Freeze="True" StartPoint="0,0" EndPoint="0,1">
    <GradientBrush.GradientStops>
      <GradientStop Color="#80FFFFFF" Offset="0.05" />
      <GradientStop Color="#00FFFFFF" Offset="0.25" />
    </GradientBrush.GradientStops>
  </LinearGradientBrush>
  <LinearGradientBrush x:Key="ProgressBarGlassyHighlight" PresentationOptions:Freeze="True" StartPoint="0,0" EndPoint="0,1">
    <GradientBrush.GradientStops>
      <GradientStop Color="#50FFFFFF" Offset="0.3333" />
      <GradientStop Color="#00FFFFFF" Offset="0.3333" />
    </GradientBrush.GradientStops>
  </LinearGradientBrush>
  <LinearGradientBrush x:Key="ProgressBarIndicatorGlassyHighlight" PresentationOptions:Freeze="True" StartPoint="0,0" EndPoint="0,1">
    <GradientBrush.GradientStops>
      <GradientStop Color="#90FFFFFF" Offset="0.3333" />
      <GradientStop Color="#00FFFFFF" Offset="0.3333" />
    </GradientBrush.GradientStops>
  </LinearGradientBrush>
  <RadialGradientBrush x:Key="ProgressBarIndicatorLightingEffectLeft" PresentationOptions:Freeze="True" RadiusX="1" RadiusY="1" RelativeTransform="1,0,0,1,0.5,0.5">
    <GradientBrush.GradientStops>
      <GradientStop Color="#60FFFFC4" Offset="0" />
      <GradientStop Color="#00FFFFC4" Offset="1" />
    </GradientBrush.GradientStops>
  </RadialGradientBrush>
  <LinearGradientBrush x:Key="ProgressBarIndicatorLightingEffect" PresentationOptions:Freeze="True" StartPoint="0,1" EndPoint="0,0">
    <GradientBrush.GradientStops>
      <GradientStop Color="#60FFFFC4" Offset="0" />
      <GradientStop Color="#00FFFFC4" Offset="1" />
    </GradientBrush.GradientStops>
  </LinearGradientBrush>
  <RadialGradientBrush x:Key="ProgressBarIndicatorLightingEffectRight" PresentationOptions:Freeze="True" RadiusX="1" RadiusY="1" RelativeTransform="1,0,0,1,-0.5,0.5">
    <GradientBrush.GradientStops>
      <GradientStop Color="#60FFFFC4" Offset="0" />
      <GradientStop Color="#00FFFFC4" Offset="1" />
    </GradientBrush.GradientStops>
  </RadialGradientBrush>
  <LinearGradientBrush x:Key="ProgressBarIndicatorDarkEdgeLeft" PresentationOptions:Freeze="True" StartPoint="0,0" EndPoint="1,0">
    <GradientBrush.GradientStops>
      <GradientStop Color="#0C000000" Offset="0" />
      <GradientStop Color="#20000000" Offset="0.3" />
      <GradientStop Color="#00000000" Offset="1" />
    </GradientBrush.GradientStops>
  </LinearGradientBrush>
  <LinearGradientBrush x:Key="ProgressBarIndicatorDarkEdgeRight" PresentationOptions:Freeze="True" StartPoint="0,0" EndPoint="1,0">
    <GradientBrush.GradientStops>
      <GradientStop Color="#00000000" Offset="0" />
      <GradientStop Color="#20000000" Offset="0.7" />
      <GradientStop Color="#0C000000" Offset="1" />
    </GradientBrush.GradientStops>
  </LinearGradientBrush>
  <LinearGradientBrush x:Key="ProgressBarIndicatorAnimatedFill" PresentationOptions:Freeze="True" MappingMode="Absolute" StartPoint="-100,0" EndPoint="0,0">
    <GradientBrush.GradientStops>
      <GradientStop Color="#00000000" Offset="0" />
      <GradientStop Color="#FF000000" Offset="0.4" />
      <GradientStop Color="#FF000000" Offset="0.6" />
      <GradientStop Color="#00000000" Offset="1" />
    </GradientBrush.GradientStops>
  </LinearGradientBrush>
  <Style x:Key="{x:Static themes:SharedResourceKeys.ProgressBarStyleKey}" TargetType="{x:Type RangeBase}">
    <Setter Property="Background" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarBackgroundNormalBrushKey}}" />
    <Setter Property="BorderBrush" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarBorderNormalBrushKey}}" />
    <Setter Property="BorderThickness" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarBorderNormalThicknessKey}}" />
    <Setter Property="Foreground" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarForegroundNormalBrushKey}}" />
    <Setter Property="themes:ProgressBarThemeProperties.IsContinuous" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarIsContinuousBooleanKey}}" />
    <Setter Property="themes:ProgressBarThemeProperties.IsGlassEnabled" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarIsGlassEnabledBooleanKey}}" />
    <Setter Property="themes:ProgressBarThemeProperties.UseHighlightForIndeterminateIndicator" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarUseHighlightForIndeterminateIndicatorBooleanKey}}" />
    <Setter Property="themes:ThemeProperties.CornerRadius" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarBorderNormalCornerRadiusKey}}" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type RangeBase}">
          <controlsPrimitives:ElementChrome x:Name="chrome" Background="{TemplateBinding Control.Background}" BorderBrush="{TemplateBinding Control.BorderBrush}" BorderThickness="{TemplateBinding Control.BorderThickness}" InnerBorderBrush="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarInnerBorderNormalBrushKey}}" InnerBorderThickness="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarInnerBorderNormalThicknessKey}}" CornerRadius="{TemplateBinding themes:ThemeProperties.CornerRadius}" SnapsToDevicePixels="true">
            <Grid Name="backgroundGrid">
              <Border CornerRadius="{TemplateBinding themes:ThemeProperties.CornerRadius}" Background="{StaticResource ProgressBarGlassyHighlight}" Visibility="{Binding Path=(themes:ProgressBarThemeProperties.IsGlassEnabled), RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BooleanToVisibilityConverter}}" />
              <Border BorderBrush="#80FFFFFF" BorderThickness="1,0,1,1" Background="{StaticResource ProgressBarTopHighlight}" Visibility="{Binding Path=(themes:ProgressBarThemeProperties.IsGlassEnabled), RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BooleanToVisibilityConverter}}" />
              <Rectangle Name="PART_Track" />
              <Decorator Name="PART_Indicator" HorizontalAlignment="Left" Margin="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarPaddingNormalThicknessKey}}">
                <UIElement.OpacityMask>
                  <MultiBinding>
                    <MultiBinding.Converter>
                      <controlsPrimitives:ProgressBarSegmentedBrushConverter />
                    </MultiBinding.Converter>
                    <Binding Path="(themes:ProgressBarThemeProperties.IsContinuous)" RelativeSource="{RelativeSource TemplatedParent}" />
                    <Binding Path="(ProgressBar.Orientation)" RelativeSource="{RelativeSource TemplatedParent}" />
                    <Binding Path="ActualWidth" ElementName="PART_Indicator" />
                    <Binding Path="ActualHeight" ElementName="PART_Indicator" />
                    <Binding Path="ActualWidth" ElementName="PART_Track" />
                    <Binding Path="ActualHeight" ElementName="PART_Track" />
                  </MultiBinding>
                </UIElement.OpacityMask>
                <Grid Name="foregroundGrid">
                  <Rectangle Name="indicator" Fill="{TemplateBinding Control.Foreground}" />
                  <Rectangle Name="animation" Fill="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarHighlightNormalBrushKey}}">
                    <UIElement.OpacityMask>
                      <MultiBinding>
                        <MultiBinding.Converter>
                          <controlsPrimitives:ProgressBarHighlightBrushConverter />
                        </MultiBinding.Converter>
                        <Binding Source="{StaticResource ProgressBarIndicatorAnimatedFill}" />
                        <Binding Path="ActualWidth" ElementName="backgroundGrid" />
                        <Binding Path="ActualHeight" ElementName="backgroundGrid" />
                      </MultiBinding>
                    </UIElement.OpacityMask>
                  </Rectangle>
                  <Grid Visibility="{Binding Path=(themes:ProgressBarThemeProperties.IsGlassEnabled), RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition MaxWidth="15" />
                      <ColumnDefinition Width="0.1*" />
                      <ColumnDefinition MaxWidth="15" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                      <RowDefinition />
                      <RowDefinition />
                    </Grid.RowDefinitions>
                    <Rectangle Name="LeftDark" Grid.RowSpan="2" RadiusX="1" RadiusY="1" Margin="1,1,0,1" Fill="{StaticResource ProgressBarIndicatorDarkEdgeLeft}" />
                    <Rectangle Name="RightDark" Grid.RowSpan="2" Grid.Column="2" RadiusX="1" RadiusY="1" Margin="0,1,1,1" Fill="{StaticResource ProgressBarIndicatorDarkEdgeRight}" />
                    <Rectangle Name="LeftLight" Grid.Column="0" Grid.Row="2" Fill="{StaticResource ProgressBarIndicatorLightingEffectLeft}" />
                    <Rectangle Name="CenterLight" Grid.Column="1" Grid.Row="2" Fill="{StaticResource ProgressBarIndicatorLightingEffect}" />
                    <Rectangle Name="RightLight" Grid.Column="2" Grid.Row="2" Fill="{StaticResource ProgressBarIndicatorLightingEffectRight}" />
                    <Border Name="Highlight1" Grid.RowSpan="2" Grid.ColumnSpan="3" Background="{StaticResource ProgressBarIndicatorGlassyHighlight}" />
                    <Border Name="Highlight2" Grid.RowSpan="2" Grid.ColumnSpan="3" Background="{StaticResource ProgressBarTopHighlight}" />
                  </Grid>
                </Grid>
              </Decorator>
            </Grid>
          </controlsPrimitives:ElementChrome>
          <ControlTemplate.Triggers>
            <Trigger Property="ProgressBar.Orientation" Value="Vertical">
              <Setter TargetName="backgroundGrid" Property="FrameworkElement.LayoutTransform">
                <Setter.Value>
                  <RotateTransform Angle="-90" />
                </Setter.Value>
              </Setter>
            </Trigger>
            <Trigger Property="ProgressBar.IsIndeterminate" Value="True">
              <Setter TargetName="LeftDark" Property="Visibility" Value="Collapsed" />
              <Setter TargetName="RightDark" Property="Visibility" Value="Collapsed" />
              <Setter TargetName="LeftLight" Property="Visibility" Value="Collapsed" />
              <Setter TargetName="CenterLight" Property="Visibility" Value="Collapsed" />
              <Setter TargetName="RightLight" Property="Visibility" Value="Collapsed" />
              <Setter TargetName="indicator" Property="Visibility" Value="Collapsed" />
              <Setter TargetName="animation" Property="Shape.Fill" Value="{Binding Path=Foreground, RelativeSource={RelativeSource TemplatedParent}}" />
            </Trigger>
            <MultiTrigger>
              <MultiTrigger.Conditions>
                <Condition Property="ProgressBar.IsIndeterminate" Value="false" />
                <Condition Property="themes:ProgressBarThemeProperties.State" Value="Normal" />
              </MultiTrigger.Conditions>
              <Setter TargetName="animation" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarHighlightNormalBrushKey}}" Property="Shape.Fill" />
            </MultiTrigger>
            <MultiTrigger>
              <MultiTrigger.Conditions>
                <Condition Property="ProgressBar.IsIndeterminate" Value="false" />
                <Condition Property="themes:ProgressBarThemeProperties.State" Value="Paused" />
              </MultiTrigger.Conditions>
              <Setter TargetName="animation" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarHighlightPausedBrushKey}}" Property="Shape.Fill" />
            </MultiTrigger>
            <MultiTrigger>
              <MultiTrigger.Conditions>
                <Condition Property="ProgressBar.IsIndeterminate" Value="false" />
                <Condition Property="themes:ProgressBarThemeProperties.State" Value="Error" />
              </MultiTrigger.Conditions>
              <Setter TargetName="animation" Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarHighlightErrorBrushKey}}" Property="Shape.Fill" />
            </MultiTrigger>
            <Trigger Property="themes:ProgressBarThemeProperties.UseHighlightForIndeterminateIndicator" Value="False">
              <Setter TargetName="indicator" Property="Visibility" Value="Visible" />
              <Setter TargetName="animation" Property="Visibility" Value="Collapsed" />
              <Setter TargetName="PART_Indicator" Property="UIElement.OpacityMask">
                <Setter.Value>
                  <MultiBinding>
                    <MultiBinding.Converter>
                      <controlsPrimitives:ProgressBarSegmentedBrushConverter />
                    </MultiBinding.Converter>
                    <Binding Path="(themes:ProgressBarThemeProperties.IsContinuous)" RelativeSource="{RelativeSource TemplatedParent}" />
                    <Binding Path="(ProgressBar.Orientation)" RelativeSource="{RelativeSource TemplatedParent}" />
                    <Binding Path="ActualWidth" ElementName="PART_Indicator" />
                    <Binding Path="ActualHeight" ElementName="PART_Indicator" />
                    <Binding Path="ActualWidth" ElementName="PART_Track" />
                    <Binding Path="ActualHeight" ElementName="PART_Track" />
                    <Binding Path="(ProgressBar.IsIndeterminate)" RelativeSource="{RelativeSource TemplatedParent}" />
                  </MultiBinding>
                </Setter.Value>
              </Setter>
            </Trigger>
            <Trigger Property="themes:ProgressBarThemeProperties.State" Value="Paused">
              <Setter Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarForegroundPausedBrushKey}}" Property="Foreground" />
            </Trigger>
            <Trigger Property="themes:ProgressBarThemeProperties.State" Value="Error">
              <Setter Value="{DynamicResource {x:Static themes:AssetResourceKeys.ProgressBarForegroundErrorBrushKey}}" Property="Foreground" />
            </Trigger>
            <Trigger Property="controls:AnimatedProgressBar.IsCompleted" Value="true">
              <Setter TargetName="animation" Property="Visibility" Value="Collapsed" />
            </Trigger>
            <Trigger Property="IsEnabled" Value="false">
              <Setter TargetName="animation" Property="Visibility" Value="Collapsed" />
            </Trigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
</ResourceDictionary>